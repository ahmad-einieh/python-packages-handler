"use strict";var k=Object.create;var u=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var P=(e,t)=>{for(var a in t)u(e,a,{get:t[a],enumerable:!0})},m=(e,t,a,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of T(t))!$.call(e,o)&&o!==a&&u(e,o,{get:()=>t[o],enumerable:!(c=x(t,o))||c.enumerable});return e};var A=(e,t,a)=>(a=e!=null?k(I(e)):{},m(t||!e||!e.__esModule?u(a,"default",{value:e,enumerable:!0}):a,e)),D=e=>m(u({},"__esModule",{value:!0}),e);var C={};P(C,{activate:()=>E,deactivate:()=>q});module.exports=D(C);var n=A(require("vscode")),w;function E(e){console.log('Congratulations, your extension "python-packages-handler" is now active!'),w=n.window.createTextEditorDecorationType({after:{margin:"0 0 0 1em",contentText:"=> ",color:"#888888",fontStyle:"italic"}});let t=n.commands.registerCommand("python-packages-handler.updatePackageVersion",async()=>{await f()});e.subscriptions.push(t);let a=n.commands.registerCommand("python-packages-handler.updateAllPackages",async()=>{await v()});e.subscriptions.push(a);let c=n.commands.registerCommand("python-packages-handler.updateAndInstallPackage",async()=>{await M()});e.subscriptions.push(c);let o=n.commands.registerCommand("python-packages-handler.updateAllAndInstallPackages",async()=>{await b()});e.subscriptions.push(o),e.subscriptions.push(n.workspace.onDidOpenTextDocument(async s=>{s.languageId==="pip-requirements"&&await g(s)}),n.workspace.onDidChangeTextDocument(async s=>{s.document.languageId==="pip-requirements"&&await g(s.document)}),n.window.onDidChangeActiveTextEditor(async s=>{s&&s.document.languageId==="pip-requirements"&&await g(s.document)}))}async function g(e){let t=n.window.visibleTextEditors.find(s=>s.document===e);if(!t)return;let a=[],o=e.getText().split(`
`);for(let s=0;s<o.length;s++){let i=o[s],d=i.trim().match(/^([\w-]+)((?:[=<>!~]+.*)?)$/);if(d){let r=d[1],l=await h(r);if(l){let p=new n.Range(s,i.length,s,i.length);a.push({range:p,renderOptions:{after:{contentText:`=> ${l}`}}})}}}t.setDecorations(w,a)}async function h(e){try{let t=await fetch(`https://pypi.org/pypi/${e}/json`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return(await t.json()).info.version}catch(t){return console.error(`Failed to fetch the latest version for ${e}:`,t),null}}async function f(){let e=n.window.activeTextEditor;if(!e){n.window.showErrorMessage("No active editor found!");return}let t=e.document;if(t.languageId!=="pip-requirements"){n.window.showErrorMessage("This command only works in requirements.txt files.");return}let a=e.selection.active,c=t.lineAt(a.line),s=c.text.trim().match(/^([\w-]+)((?:[=<>!~]+.*)?)$/);if(!s){n.window.showErrorMessage("Invalid package specification.");return}let i=s[1],d=s[2]||"==";try{let r=await h(i);if(!r)throw new Error("Failed to fetch latest version");let l=d?`${i}${d.split(/\d/)[0]}${r}`:`${i}==${r}`;await e.edit(p=>{p.replace(c.range,l)}),await t.save(),n.window.showInformationMessage(`Updated ${i} to version ${r} and saved the file.`)}catch{n.window.showErrorMessage(`Failed to fetch the latest version for ${i}.`)}}async function v(){let e=n.window.activeTextEditor;if(!e||e.document.languageId!=="pip-requirements"){n.window.showErrorMessage("This command only works in requirements.txt files.");return}let t=e.document,c=t.getText().split(`
`),o=[];for(let s of c){let i=s.trim().match(/^([\w-]+)((?:[=<>!~]+.*)?)$/);if(i){let d=i[1],r=i[2]||"==";try{let l=await h(d);if(l){let p=r?`${d}${r.split(/\d/)[0]}${l}`:`${d}==${l}`;o.push(p)}else o.push(s)}catch{o.push(s)}}else o.push(s)}await e.edit(s=>{let i=new n.Range(t.positionAt(0),t.positionAt(t.getText().length));s.replace(i,o.join(`
`))}),await t.save(),n.window.showInformationMessage("Updated all packages to their latest versions and saved the file.")}async function M(){await f(),await y()}async function b(){await v(),await y()}async function y(){let e=n.window.createTerminal("Python Package Installer");e.show(),e.sendText("pip install -r requirements.txt --upgrade"),n.window.showInformationMessage("Installing updated packages..."),await new Promise(t=>setTimeout(t,5e3)),n.window.showInformationMessage("Packages installed successfully.")}function q(){w&&w.dispose()}0&&(module.exports={activate,deactivate});
